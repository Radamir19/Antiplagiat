# Домашняя работа №3: Микросервисная система "Антиплагиат"

Система для загрузки студенческих работ и их проверки на заимствования. Реализовано синхронное взаимодействие между микросервисами.

## Стек и Архитектура

Проект разбит на микросервисы согласно требованиям (Single Responsibility Principle):

1.  **ApiGateway (Ocelot)**
    *   *Зачем:* Единая точка входа. Клиент общается только с `localhost:5005`, не зная о внутренних портах сервисов. Маршрутизирует запросы.
2.  **FileStorageService**
    *   *Зачем:* Отвечает только за сохранение файлов на диск и их отдачу по ID. Хранит метаданные (кто, когда, какое задание).
3.  **AnalysisService**
    *   *Зачем:* Содержит бизнес-логику. Синхронно запрашивает файл у StorageService, проводит анализ и генерирует отчеты.
    *   *Бонус:* Генерирует ссылку на **Облако слов** (через QuickChart API) для визуализации контента.

**Технологии:** C# (.NET 8), Docker, Docker Compose.

---

## Алгоритм проверки

В соответствии с заданием реализован алгоритм обнаружения полных дубликатов **"Хэш-коллизия"**:

1.  При поступлении файла на проверку вычисляется его **MD5-хэш**.
2.  Система ищет в базе уже проверенных работ совпадения по трем критериям:
    *   Хэш файлов совпадает.
    *   ID задания (`TaskId`) совпадает.
    *   Имя студента (`StudentName`) **отличается** от текущего.
3.  Если совпадение найдено — выставляется флаг `isPlagiarism: true`.

---

## Запуск

Для запуска нужен только **Docker Desktop**.

1.  Докер должен быть запущен.
2.  Откройте терминал в папке с проектом (где файл `docker-compose.yml`).
3.  Запустите сборку и старт контейнеров:
    ```bash
    docker compose up --build
    ```
4.  Дождитесь сообщения в логах `Now listening on: http://[::]:8080` от всех сервисов.

**Важно:** API будет доступно по порту **5005** (чтобы избежать конфликта с AirPlay на macOS, для Linux и Windows также подойдет).
Адрес: `http://localhost:5005`

---

## Тестирование

Рекомендуется использовать **Postman**.
В корне проекта лежит файл `Postman_Collection.json` с готовыми запросами.

**Ручной сценарий проверки:**

1.  **Загрузка работы (Студент А):**
    *   `POST http://localhost:5005/gateway/upload`
    *   Body (form-data): `File` (файл.txt), `StudentName`: "Ivanov", `TaskId`: "Task1".
    *   *Получаем `fileId`.*

2.  **Анализ работы (Студент А):**
    *   `POST http://localhost:5005/gateway/analyze`
    *   Body (json): `{ "fileId": "..." }`
    *   *Результат: `isPlagiarism: false`.*

3.  **Попытка плагиата (Студент Б):**
    *   Повторить шаг 1 с **тем же файлом**, но `StudentName`: "Petrov".
    *   Получить новый `fileId`.
    *   Выполнить анализ (шаг 2) с новым ID.
    *   *Результат: `isPlagiarism: true`.*

4.  **Отчет преподавателя:**
    *   `GET http://localhost:5005/gateway/reports/Task1`
    *   *Видим список всех проверок.*
